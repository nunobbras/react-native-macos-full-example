'use strict';

Object.defineProperty(exports, "__esModule", {
    value: true
});

var _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };

exports.default = function (engine, ms) {
    var lastTimeout = undefined;
    var lastReject = undefined;

    return _extends({}, engine, {
        save: function save(state) {
            clearTimeout(lastTimeout);
            if (lastReject) {
                lastReject(Error('Debounced, newer action pending'));
                lastReject = null;
            }

            return new Promise(function (resolve, reject) {
                lastReject = reject;
                lastTimeout = setTimeout(function () {
                    lastReject = null;
                    engine.save(state).then(resolve)['catch'](reject);
                }, ms);
            });
        }
    });
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9kZWNvcmF0b3JzL2RlYm91bmNlLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O2tCQUFlLFVBQUMsTUFBRCxFQUFTLEVBQVQsRUFBZ0I7QUFDM0IsUUFBSSx1QkFBSixDQUQyQjtBQUUzQixRQUFJLHNCQUFKLENBRjJCOztBQUkzQix3QkFDTztBQUVILDRCQUFLLE9BQU87QUFDUix5QkFBYSxXQUFiLEVBRFE7QUFFUixnQkFBSSxVQUFKLEVBQWdCO0FBQ1osMkJBQVcsTUFBTSxpQ0FBTixDQUFYLEVBRFk7QUFFWiw2QkFBYSxJQUFiLENBRlk7YUFBaEI7O0FBS0EsbUJBQU8sSUFBSSxPQUFKLENBQVksVUFBQyxPQUFELEVBQVUsTUFBVixFQUFxQjtBQUNwQyw2QkFBYSxNQUFiLENBRG9DO0FBRXBDLDhCQUFjLFdBQVcsWUFBTTtBQUMzQixpQ0FBYSxJQUFiLENBRDJCO0FBRTNCLDJCQUFPLElBQVAsQ0FBWSxLQUFaLEVBQW1CLElBQW5CLENBQXdCLE9BQXhCLFdBQXVDLE1BQXZDLEVBRjJCO2lCQUFOLEVBR3RCLEVBSFcsQ0FBZCxDQUZvQzthQUFyQixDQUFuQixDQVBROztNQUhoQixDQUoyQjtDQUFoQiIsImZpbGUiOiJkZWJvdW5jZS5qcyIsInNvdXJjZXNDb250ZW50IjpbImV4cG9ydCBkZWZhdWx0IChlbmdpbmUsIG1zKSA9PiB7XG4gICAgbGV0IGxhc3RUaW1lb3V0O1xuICAgIGxldCBsYXN0UmVqZWN0O1xuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgLi4uZW5naW5lLFxuXG4gICAgICAgIHNhdmUoc3RhdGUpIHtcbiAgICAgICAgICAgIGNsZWFyVGltZW91dChsYXN0VGltZW91dCk7XG4gICAgICAgICAgICBpZiAobGFzdFJlamVjdCkge1xuICAgICAgICAgICAgICAgIGxhc3RSZWplY3QoRXJyb3IoJ0RlYm91bmNlZCwgbmV3ZXIgYWN0aW9uIHBlbmRpbmcnKSk7XG4gICAgICAgICAgICAgICAgbGFzdFJlamVjdCA9IG51bGw7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICAgICAgICAgICAgbGFzdFJlamVjdCA9IHJlamVjdDtcbiAgICAgICAgICAgICAgICBsYXN0VGltZW91dCA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBsYXN0UmVqZWN0ID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgZW5naW5lLnNhdmUoc3RhdGUpLnRoZW4ocmVzb2x2ZSkuY2F0Y2gocmVqZWN0KTtcbiAgICAgICAgICAgICAgICB9LCBtcyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH07XG59O1xuIl19